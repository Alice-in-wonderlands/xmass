<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Postcard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Homemade+Apple&family=Mountains+of+Christmas:wght@400;700&display=swap" rel="stylesheet"> 
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'christmas-red': '#B22222',
                        'christmas-green': '#03241b',
                        'gold': '#D4AF37',
                        'paper-cream': '#FDF5E6',
                    },
                    fontFamily: {
                        'handwriting': ['Homemade Apple', 'cursive'],
                        'festive': ['Mountains of Christmas', 'serif'],
                    },
                    keyframes: {
                        twinkle: { '0%, 100%': { opacity: 1 }, '50%': { opacity: 0.3 } }
                    },
                    animation: {
                        twinkle: 'twinkle 1.5s infinite ease-in-out',
                    }
                }
            }
        }
    </script>
    <style>
        .light-string {
            position: absolute;
            top: 0; left: 0; width: 100%;
            height: 40px;
            display: flex; justify-content: space-around;
            z-index: 60;
            pointer-events: none;
        }
        .light {
            width: 12px; height: 12px;
            border-radius: 50%;
            box-shadow: 0 0 10px white;
        }
        .postcard-container {
            background-color: #FDF5E6;
            background-image: radial-gradient(#dbd2bc 0.5px, transparent 0.5px);
            background-size: 10px 10px;
            border: 15px solid white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3), inset 0 0 100px rgba(0,0,0,0.05);
            position: relative;
            min-height: 500px;
        }
        .postcard-divider {
            position: absolute;
            left: 50%; top: 10%; bottom: 10%;
            width: 2px;
            background: linear-gradient(to bottom, transparent, #8B4513, transparent);
            opacity: 0.3;
        }
        .stamp-area {
            width: 80px; height: 100px;
            border: 2px dashed #8B4513;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.5);
        }
        .address-line {
            border-bottom: 1px solid #8B4513;
            margin-bottom: 1.5rem;
            width: 100%;
        }
    </style>
</head>

<body class="bg-christmas-green min-h-screen flex items-center justify-center p-4 overflow-hidden" onclick="playMusic()">
    
    <audio id="christmas-music" loop autoplay>
        <source src="song.mp3" type="audio/mpeg">
    </audio>

    <div class="light-string">
        <div class="light bg-red-500 animate-twinkle"></div>
        <div class="light bg-yellow-400 animate-twinkle" style="animation-delay: 0.2s"></div>
        <div class="light bg-blue-500 animate-twinkle" style="animation-delay: 0.4s"></div>
        <div class="light bg-green-500 animate-twinkle" style="animation-delay: 0.6s"></div>
        <div class="light bg-red-500 animate-twinkle" style="animation-delay: 0.8s"></div>
        <div class="light bg-yellow-400 animate-twinkle" style="animation-delay: 1s"></div>
    </div>

    <canvas id="snow-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-0"></canvas>

    <div id="app-container" class="w-full max-w-5xl relative z-10">

        <div id="merry-christmas-cover" class="bg-christmas-red rounded-3xl shadow-2xl flex flex-col items-center justify-center p-12 transition-all duration-500 cursor-pointer hover:scale-[1.01] border-8 border-gold/30" onclick="openCover()">
            <div class="text-white text-6xl md:text-8xl font-festive font-bold tracking-tighter animate-pulse text-center">
                Merry Christmas
            </div>
            <div class="mt-6 px-6 py-2 bg-gold text-christmas-green font-bold rounded-full transform -rotate-2">
                FROM ALICE WITH LOVE
            </div>
            <p class="text-white/70 mt-12 animate-bounce">Nh·∫•n v√†o ƒë√¢y ƒë·ªÉ nh·∫≠n th∆∞... ‚ùÑÔ∏è</p>
        </div>

        <div id="password-stage" class="hidden flex-col items-center justify-center">
            <div class="bg-white/95 backdrop-blur p-10 rounded-2xl shadow-2xl w-full max-w-sm border-t-8 border-christmas-red">
                <h2 class="text-3xl font-festive font-bold text-christmas-red text-center mb-6">X√°c nh·∫≠n danh t√≠nh</h2>
                <input type="text" id="password-input" placeholder="T√™n c·ªßa b·∫°n l√†..." 
                       class="w-full p-4 border-2 border-gold/30 rounded-xl focus:outline-none focus:border-christmas-red text-center text-lg mb-6">
                <button onclick="checkPassword()" class="w-full py-4 bg-christmas-red text-white font-bold rounded-xl hover:bg-red-700 transition-colors">
                    M·ªû QU√Ä üéÅ
                </button>
                <p id="error-message" class="text-red-600 mt-4 text-center hidden">B·∫°n kh√¥ng c√≥ trong danh s√°ch nh·∫≠n th∆∞ r·ªìi!</p>
            </div>
        </div>

        <div id="sealed-envelope-stage" class="hidden flex-col items-center justify-center">
            <div class="relative w-full max-w-md aspect-[4/3] bg-red-800 rounded-lg shadow-[0_30px_60px_rgba(0,0,0,0.5)] border-4 border-gold/20 flex items-center justify-center cursor-pointer overflow-hidden group" onclick="openSealedEnvelope()">
                <div id="envelope-flap" class="absolute top-0 left-0 w-full h-1/2 bg-red-900 z-20 origin-top transition-transform duration-700" style="clip-path: polygon(0 0, 100% 0, 50% 100%);"></div>
                <div id="envelope-seal" class="absolute top-1/2 left-1/2 z-30 transition-all duration-700"
                     style="transform: translate(-50%, -20%);">
                    <div class="w-20 h-20 bg-gold rounded-full flex items-center justify-center shadow-[0_4px_10px_rgba(0,0,0,0.3)] border-4 border-yellow-600 ring-2 ring-gold ring-offset-2 ring-offset-red-900">
                        <span class="text-4xl drop-shadow-md">üéÑ</span>
                    </div>
                </div>
                <div class="text-center z-10 mt-44">
                    <p id="envelope-recipient-name" class="text-gold font-handwriting text-2xl drop-shadow-sm"></p>
                </div>
            </div>
            <p class="text-white mt-6 font-festive text-xl">Ch·∫°m v√†o phong b√¨ ƒë·ªÉ x√© tem...</p>
        </div>

        <div id="card-stage" class="hidden flex-col">
            <div class="postcard-container rounded-sm flex flex-col md:flex-row p-6 md:p-10 text-stone-800 font-handwriting">
                <div class="postcard-divider hidden md:block"></div>
                <div class="w-full md:w-1/2 md:pr-10 flex flex-col">
                    <img id="recipient-photo" src="" class="w-32 h-32 rounded-lg object-cover border-4 border-white shadow-md mb-4 -rotate-3">
                    <div id="ai-intro-text" class="text-christmas-red italic text-sm mb-4 leading-relaxed"></div>
                    <div id="main-message" class="text-lg leading-loose overflow-y-auto max-h-[300px] pr-2 whitespace-pre-line"></div>
                </div>
                <div class="w-full md:w-1/2 md:pl-10 mt-10 md:mt-0 flex flex-col items-end">
                    <div class="stamp-area mb-12 rotate-3">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/17/Royal_Mail_logo.svg/1024px-Royal_Mail_logo.svg.png" class="w-16 grayscale opacity-70">
                    </div>
                    <div class="w-full space-y-8 mt-4">
                        <div class="address-line">To: <span id="addr-name" class="ml-4 text-xl font-bold"></span></div>
                        <div class="address-line">North Pole, Christmas Lane</div>
                        <div class="address-line">Happiness Street 1225</div>
                    </div>
                    <div class="mt-auto pt-8">
                        <button id="outro-button" onclick="loadOutroMessage()" class="bg-christmas-green text-white px-6 py-2 rounded-full text-sm hover:bg-green-800 transition-colors">
                             M·ªü l·ªùi ch√∫c b√≠ m·∫≠t ‚ú®
                        </button>
                        <p id="ai-outro-message" class="text-sm text-christmas-red mt-4 italic max-w-[250px] text-right"></p>
                    </div>
                </div>
            </div>
            <button onclick="location.reload()" class="mt-8 text-white/50 hover:text-white mx-auto underline">G·ª≠i th∆∞ kh√°c</button>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        const API_MODEL = 'gemini-1.5-flash';

        const recipientNamesMap = { 
            caitlin: 'Caitlin', sophie: 'Sophie', dan: 'Dan', gemma: 'Gemma',
            anya: 'Anya', libby: 'Libby', lizzie: 'Lizzie', ciara: 'Ciara',
            harriet: 'Harriet', hannah: 'Hannah', zach: 'Zach', jordy: 'Jordy'
        };

        const letterContents = {
            caitlin: { image: 'WILL1.jpg', message: "Caitlin th√¢n m·∫øn,\n\nD√π ch√∫ng ta c√°ch xa nhau h√†ng ng√†n d·∫∑m, h∆°i ·∫•m t√¨nh b·∫°n v·∫´n lu√¥n ·ªü ƒë√¢y. Ch√∫c c·∫≠u m·ªôt m√πa Gi√°ng sinh l·∫•p l√°nh!" },
            sophie: { image: 'WILL4.jpg', message: "Sophie ∆°i,\n\nT·ªõ hy v·ªçng b∆∞u thi·∫øp n√†y s·∫Ω mang theo m·ªôt ch√∫t tuy·∫øt tr·∫Øng v√† th·∫≠t nhi·ªÅu ni·ªÅm vui ƒë·∫øn v·ªõi c·∫≠u!" },
            dan: { image: 'WILL3.jpg', message: "Ch√†o Dan,\n\nGi√°ng sinh kh√¥ng ch·ªâ l√† qu√† c√°p, m√† l√† vi·ªác nh·ªõ v·ªÅ nh·ªØng ng∆∞·ªùi b·∫°n tuy·ªát v·ªùi. Ch√∫c √¥ng th·∫≠t chill nh√©!" },
            gemma: { image: 'WILL2.jpg', message: "Gemma th√¢n y√™u,\n\nCh√∫c c·∫≠u m·ªôt nƒÉm m·ªõi r·ª±c r·ª° v√† m·ªôt ƒë√™m Noel tr√†n ƒë·∫ßy ti·∫øng c∆∞·ªùi. C·∫£m ∆°n v√¨ t·∫•t c·∫£!" },
            anya: { image: 'WILL1.jpg', message: "Anya th√¢n m·∫øn,\n\nCh√∫c c·∫≠u m·ªôt m√πa Gi√°ng sinh r·∫°ng r·ª° v√† tr√†n ng·∫≠p ni·ªÅm vui b√™n gia ƒë√¨nh." },
            libby: { image: 'WILL2.jpg', message: "Libby ∆°i,\n\nMong r·∫±ng m√πa l·ªÖ n√†y s·∫Ω mang ƒë·∫øn cho c·∫≠u th·∫≠t nhi·ªÅu k·ª∑ ni·ªám ƒë·∫πp v√† nh·ªØng m√≥n qu√† b·∫•t ng·ªù!" },
            lizzie: { image: 'WILL3.jpg', message: "G·ª≠i Lizzie,\n\nCh√∫c c·∫≠u m·ªôt ƒë√™m Noel ·∫•m √°p, an l√†nh v√† lu√¥n gi·ªØ ƒë∆∞·ª£c n·ª• c∆∞·ªùi t∆∞∆°i t·∫Øn tr√™n m√¥i nh√©!" },
            ciara: { image: 'WILL4.jpg', message: "Ciara th√¢n y√™u,\n\nHy v·ªçng c·∫≠u s·∫Ω c√≥ m·ªôt k·ª≥ ngh·ªâ th·∫≠t tuy·ªát v·ªùi v√† b·∫Øt ƒë·∫ßu m·ªôt nƒÉm m·ªõi ƒë·∫ßy h·ª©ng kh·ªüi!" },
            harriet: { image: 'WILL1.jpg', message: "Harriet √†,\n\nCh√∫c c·∫≠u m·ªôt m√πa Gi√°ng sinh k·ª≥ di·ªáu nh∆∞ nh·ªØng c√¢u chuy·ªán c·ªï t√≠ch. C·∫£m ∆°n c·∫≠u!" },
            hannah: { image: 'WILL2.jpg', message: "Hannah th√¢n m·∫øn,\n\nC·∫£m ∆°n v√¨ ƒë√£ lu√¥n ƒë·ªìng h√†nh c√πng t·ªõ. Ch√∫c c·∫≠u m·ªôt nƒÉm m·ªõi th·∫≠t b√πng n·ªï!" },
            zach: { image: 'WILL3.jpg', message: "Ch√†o Zach,\n\nCh√∫c √¥ng m·ªôt m√πa l·ªÖ h·ªôi c·ª±c ch√°y, ƒë·∫ßy ·∫Øp ƒë·ªì ƒÉn ngon v√† gi√¢y ph√∫t th∆∞ gi√£n nh√©!" },
            jordy: { image: 'WILL4.jpg', message: "Jordy ∆°i,\n\nCh√∫c c·∫≠u m·ªôt m√πa Gi√°ng sinh ·∫•m √°p v√† m·ªôt nƒÉm m·ªõi g·∫∑t h√°i ƒë∆∞·ª£c th·∫≠t nhi·ªÅu th√†nh c√¥ng!" }
        };

        const music = document.getElementById('christmas-music');
        let musicStarted = false;

        function playMusic() {
            if (!musicStarted) {
                music.play().catch(() => {});
                musicStarted = true;
            }
        }

        function openCover() {
            playMusic();
            document.getElementById('merry-christmas-cover').classList.add('hidden');
            const pwdStage = document.getElementById('password-stage');
            pwdStage.classList.remove('hidden');
            pwdStage.classList.add('flex');
        }

        function checkPassword() {
            const val = document.getElementById('password-input').value.toLowerCase().trim();
            if (letterContents[val]) {
                document.getElementById('password-stage').classList.replace('flex', 'hidden');
                document.getElementById('envelope-recipient-name').innerText = "To: " + recipientNamesMap[val];
                const envStage = document.getElementById('sealed-envelope-stage');
                envStage.classList.remove('hidden');
                envStage.classList.add('flex');
                currentRecipient = val;
                loadIntroMessage(recipientNamesMap[val]);
            } else {
                document.getElementById('error-message').classList.remove('hidden');
            }
        }

        function openSealedEnvelope() {
            document.getElementById('envelope-flap').style.transform = 'rotateX(180deg)';
            const seal = document.getElementById('envelope-seal');
            seal.style.opacity = '0';
            seal.style.transform = 'translate(-50%, -150%)';
            setTimeout(() => {
                document.getElementById('sealed-envelope-stage').classList.replace('flex', 'hidden');
                renderPostcard();
            }, 800);
        }

        function renderPostcard() {
            const data = letterContents[currentRecipient];
            document.getElementById('card-stage').classList.remove('hidden');
            document.getElementById('card-stage').classList.add('flex');
            document.getElementById('recipient-photo').src = data.image;
            document.getElementById('main-message').innerText = data.message;
            document.getElementById('addr-name').innerText = recipientNamesMap[currentRecipient];
        }

        async function loadIntroMessage(name) {
            document.getElementById('ai-intro-text').innerText = "Merry Christmas, " + name + "!";
        }

        async function loadOutroMessage() {
            const btn = document.getElementById('outro-button');
            btn.classList.add('hidden');
            document.getElementById('ai-outro-message').innerText = "H·∫°nh ph√∫c nh√©, ng∆∞·ªùi b·∫°n tuy·ªát v·ªùi c·ªßa t·ªõ! ‚ú®";
        }

        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let flakes = [];
        function initSnow() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            flakes = [];
            for(let i=0; i<100; i++) flakes.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*3+1, d: Math.random()*1});
        }
        function drawSnow() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.beginPath();
            flakes.forEach(f => {
                ctx.moveTo(f.x, f.y);
                ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
                f.y += Math.cos(f.d) + 1 + f.r/2;
                f.x += Math.sin(f.d) * 2;
                if(f.y > canvas.height) { f.y = -10; f.x = Math.random()*canvas.width; }
            });
            ctx.fill();
            requestAnimationFrame(drawSnow);
        }
        window.addEventListener('resize', initSnow);
        window.onload = () => { initSnow(); drawSnow(); };
    </script>
</body>
</html>
